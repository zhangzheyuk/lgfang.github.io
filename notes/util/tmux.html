<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Tmux Tips</title>
<!-- 2015-03-05 Thu 14:22 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Fang Lungang" />
<link rel="stylesheet" type="text/css" href="../cssjs/lgfang.css" />

<script type="text/javascript" src="../cssjs/org-info.js">
/**
 *
 * @source: ../cssjs/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in ../cssjs/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in ../cssjs/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "1");
org_html_manager.set("LINK_HOME", "../../index.html");
org_html_manager.set("LINK_UP", "../index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body><div class="container-narrow">
<div id="content">
<h1 class="title">Tmux Tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Attach or create automatically</a></li>
<li><a href="#sec-2">2. Temporarily "maximize" a pane</a></li>
<li><a href="#sec-3">3. Automatically attach to a session on login</a></li>
<li><a href="#sec-4">4. Resize current pane without mouse</a></li>
<li><a href="#sec-5">5. Share "clipboard" between Emacs and Tmux</a></li>
<li><a href="#sec-6">6. Populate the "clipboard"</a></li>
<li><a href="#sec-7">7. Share windows among sessions</a></li>
<li><a href="#sec-8">8. Share sessions with another account</a></li>
<li><a href="#sec-9">9. Resque</a>
<ul>
<li><a href="#sec-9-1">9.1. Socket file deleted by mistake?</a></li>
<li><a href="#sec-9-2">9.2. Where is my processes?</a></li>
<li><a href="#sec-9-3">9.3. Backspace and delete does not work?</a></li>
</ul>
</li>
<li><a href="#sec-10">10. My configure files</a>
<ul>
<li><a href="#sec-10-1">10.1. Color themes</a>
<ul>
<li><a href="#sec-10-1-1">10.1.1. block</a></li>
<li><a href="#sec-10-1-2">10.1.2. concise</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-11">11. An example of scripting tmux</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Attach or create automatically</h2>
<div class="outline-text-2" id="text-1">
<p>
Attach to an existing tmux session if there is already one. Otherwise,
creating one.
</p>

<div class="org-src-container">

<pre class="src src-shell-script"><span class="org-keyword">function</span> <span class="org-function-name">tg</span> {                   <span class="org-comment-delimiter"># </span><span class="org-comment">tmux go!</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">Attach to a session. If it does not exist, create that session. If no</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">session name specified, prompt to choose one from existing ones.</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">A simple/naive replacement of this "bloated" function:</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">tmux -2 attach -t "$session_name" || tmux -2 new -s "$session_name"</span>

    <span class="org-builtin">local</span> <span class="org-variable-name">usage</span>=<span class="org-string">"tg [-d] [session_name]"</span>
    <span class="org-builtin">local</span> <span class="org-variable-name">detach_others</span>=<span class="org-string">""</span>

    <span class="org-keyword">while </span><span class="org-builtin">getopts</span> <span class="org-string">"d"</span> opt; <span class="org-keyword">do</span>
        <span class="org-keyword">case</span> $<span class="org-variable-name">opt</span><span class="org-keyword"> in</span>
            d) <span class="org-variable-name">detach_others</span>=<span class="org-string">"-d"</span>;;
            ?) <span class="org-builtin">echo</span> $<span class="org-variable-name">usage</span> &gt;&amp;2;;
        <span class="org-keyword">esac</span>
    <span class="org-keyword">done</span>
    <span class="org-builtin">shift</span> $((OPTIND - 1))

    <span class="org-builtin">local</span> <span class="org-variable-name">session_name</span>=<span class="org-string">"$1"</span>

    <span class="org-keyword">if</span> [ -n <span class="org-string">"$session_name"</span> ]; <span class="org-keyword">then</span>
        tmux -2 attach $<span class="org-variable-name">detach_others</span> -t <span class="org-string">"$session_name"</span> <span class="org-sh-escaped-newline">\</span>
            || tmux -2 new -s <span class="org-string">"$session_name"</span>
        <span class="org-keyword">return</span>
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">No session name specified, act according to the number of sessions</span>
    <span class="org-builtin">local</span> <span class="org-variable-name">sessions</span>=$(<span class="org-sh-quoted-exec">tmux</span> list-sessions -F <span class="org-string">"#{session_name}"</span>)

    <span class="org-keyword">if</span> [ -z <span class="org-string">"$sessions"</span> ]; <span class="org-keyword">then</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">No session, create a default one</span>
        tmux -2 new -s <span class="org-string">'misc'</span>
        <span class="org-keyword">return</span>
    <span class="org-keyword">fi</span>

    <span class="org-keyword">if</span> [ $(<span class="org-sh-quoted-exec">echo</span> <span class="org-string">"$sessions"</span> | wc -l) -eq 1 ]; <span class="org-keyword">then</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">Only one session existing, attach to it without prompt</span>
        tmux -2 attach $<span class="org-variable-name">detach_others</span> -t <span class="org-string">"$sessions"</span>
        <span class="org-keyword">return</span>
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">Multiple sessions, prompt to choose one</span>
    <span class="org-builtin">local</span> <span class="org-variable-name">IFS</span>=$<span class="org-string">'\n'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">In case session names contain whitespaces. Must 'local' to</span>
                    <span class="org-comment-delimiter"># </span><span class="org-comment">NOT pollute the global 'IFS'. $'LITERAL_STR' =&gt; ansi-c</span>
                    <span class="org-comment-delimiter"># </span><span class="org-comment">quoting</span>
    <span class="org-builtin">local</span> <span class="org-variable-name">PS3</span>=<span class="org-string">"Select a session: "</span>

    <span class="org-keyword">select</span> session_name<span class="org-keyword"> in</span> $<span class="org-variable-name">sessions</span>; <span class="org-keyword">do</span>

        <span class="org-keyword">if</span> [ -n <span class="org-string">"$session_name"</span> ]; <span class="org-keyword">then</span> <span class="org-comment-delimiter"># </span><span class="org-comment">A valid choice</span>
            tmux -2 attach $<span class="org-variable-name">detach_others</span> -t <span class="org-string">"$session_name"</span>
            <span class="org-keyword">return</span>
        <span class="org-keyword">else</span>
            <span class="org-builtin">echo</span> <span class="org-string">"Invalid index '$REPLY', please retry"</span>
        <span class="org-keyword">fi</span>

    <span class="org-keyword">done</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Temporarily "maximize" a pane</h2>
<div class="outline-text-2" id="text-2">
<p>
Tmux 1.8 or above have built-in support ('Prefix + z')
</p>

<p>
This is for older tmux from
<a href="http://superuser.com/questions/238702/maximizing-a-pane-in-tmux">http://superuser.com/questions/238702/maximizing-a-pane-in-tmux</a>
</p>

<div class="org-src-container">

<pre class="src src-conf-space"><span class="org-variable-name">unbind</span> +
<span class="org-variable-name">bind-key</span> + run <span class="org-string">"if [[ $(tmux list-window) =~ MAX ]]; then \</span>
<span class="org-string">         tmux last-window;\</span>
<span class="org-string">         tmux swap-pane -s MAX.0; \</span>
<span class="org-string">         tmux kill-window -t MAX; \</span>
<span class="org-string">         else tmux new-window -d -n MAX; \</span>
<span class="org-string">         tmux swap-pane -s MAX.0; \</span>
<span class="org-string">         tmux select-window -t MAX;fi"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Automatically attach to a session on login</h2>
<div class="outline-text-2" id="text-3">
<p>
There are a handful of ways to achieve this, each of which affects
different set of clients. Choose per your need/trade-off.
</p>

<ul class="org-ul">
<li>To do it once

<pre class="example">
ssh user@host -t 'tmux attach -t foo'
</pre>
</li>

<li>For PuTTY users,

<ol class="org-ol">
<li>Put "tmux -2 attach || tmux -2 new -s foo" into PuTTY's
configuration panel: "connection -&gt; ssh -&gt; remote command".
</li>

<li>In "connection -&gt; data", add environment variable
<code>LANG=en_US.UTF-8</code>.
</li>
</ol>
</li>

<li>If you are using "konsole" (locally), edit konsole's profile
"general-&gt;command" to this:

<pre class="example">
/bin/bash -c "tmux attach || tmux new -s foo"
</pre>
</li>

<li>Use the feature "forced command" of SSH.

<p>
This affects ssh connections only. For details, refer to <a href="ssh.html">my ssh tips</a>.
</p>

<p>
Note that:
</p>
<ul class="org-ul">
<li>Specify absolute path for tmux.
</li>
<li>Set 'LANG' to utf8 so that pane borders are shown correctly.
</li>
</ul>
</li>

<li>The most aggressive way, attach to tmux in <code>.bash_profile</code>

<p>
This measure takes effect wherever you connect from, whatever
protocol you are using.
</p>

<p>
Put this following line into your <code>.bash_profile</code>
</p>
<div class="org-src-container">

<pre class="src src-shell-script">[ -n <span class="org-string">"$TMUX"</span> ] || tg
</pre>
</div>

<p>
Note that:
</p>
<ol class="org-ol">
<li>"tg" is the function alias defined previously
</li>
<li>This line needn't be the last line in your profile
</li>
<li>NOTE: Connecting to localhost results in recursive tmux sessions,
which eventually render the tmux session unusable. <code>ssh localhost
       -t /bin/bash</code> if you really need to login back to localhost since
this way a non-login interactive shell is opened.
</li>
</ol>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Resize current pane without mouse</h2>
<div class="outline-text-2" id="text-4">
<pre class="example">
resize-pane -[UDLR] N
</pre>

<p>
where U for Up, D for Down etc. and N is adjustment in cells or lines.
</p>

<p>
Or, <code>F12 M-&lt;arrow&gt;</code>.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Share "clipboard" between Emacs and Tmux</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">lgfang-send-tmux-copied</span> ()
  <span class="org-doc">"Send head of the kill-ring to tmux's buffer"</span>
  (interactive)
  (<span class="org-keyword">let</span> ((file (make-temp-file <span class="org-string">"/tmp/emacs-to-tmux.clip"</span>)))
    (<span class="org-keyword">with-temp-file</span> file (insert-for-yank (current-kill 0)))
    (call-process <span class="org-string">"tmux"</span> nil nil nil <span class="org-string">"load-buffer"</span> file)
    (delete-file file)))

(<span class="org-keyword">defun</span> <span class="org-function-name">lgfang-get-tmux-copied</span> ()
  <span class="org-doc">"Get current tmux buffer"</span>
  (interactive)
  (call-process <span class="org-string">"tmux"</span> nil t nil <span class="org-string">"show-buffer"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Populate the "clipboard"</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-shell-script"><span class="org-keyword">function</span> <span class="org-function-name">copy_to_tmux</span> {
    <span class="org-comment-delimiter"># </span><span class="org-comment">usage: cat file | this_function</span>
    <span class="org-keyword">while </span><span class="org-builtin">read</span> line; <span class="org-keyword">do</span>
        tmux set-buffer <span class="org-string">"$line"</span>
    <span class="org-keyword">done</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Share windows among sessions</h2>
<div class="outline-text-2" id="text-7">
<p>
In addition to move windows among sessions, it is also possible to make
certain windows present in multiple sessions simultaneously.
</p>

<pre class="example">
tmux link-window -s session:window
tmux unlink-window
</pre>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Share sessions with another account</h2>
<div class="outline-text-2" id="text-8">
<p>
It seems to me the only benefit is that you do not share your
password.
</p>

<ul class="org-ul">
<li>To share all:
<ol class="org-ol">
<li>Find corresponding socket by <code>echo ${TMUX%%,*}</code> in the session
</li>
<li>Make it readable/writable to others <code>chmod 777 /path/to/socket</code>
</li>
<li>Others attach with <code>tmux -S /path/to/socket attach</code>
</li>
</ol>
</li>

<li>To share only one session: start that session with a separate socket, make
it readable/writable by others.
<pre class="example">
tmux -S /path/to/socket_to_share [new-session -s session_name]
</pre>
</li>
</ul>

<p>
NOTE: according to test:
</p>

<ul class="org-ul">
<li>If the socket is writable by others, you (the tmux owner) cannot connect to
the tmux server unless explicitly "-S".
<pre class="example">
$ tmux list-sessions
health: 2 windows (created Thu May 29 09:30:17 2014) [167x44]
package: 3 windows (created Wed May 28 09:02:17 2014) [167x44]

$ chmod -R 0770 /tmp/tmux-30435/

$ tmux list-sessions
can't create socket

$ tmux attach
can't create socket

$ tmux -S /tmp/tmux-30435/default list-sessions
health: 2 windows (created Thu May 29 09:30:17 2014) [167x44]
package: 3 windows (created Wed May 28 09:02:17 2014) [167x44]
</pre>
</li>

<li>Once your peer connected to your tmux, you can chmod back without breaking
his/her connection.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Resque</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Socket file deleted by mistake?</h3>
<div class="outline-text-3" id="text-9-1">
<p>
According to tmux manul
</p>
<blockquote>
<p>
If the socket is accidentally removed, the SIGUSR1 signal may be sent to the
tmux server process to recreate it.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> Where is my processes?</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Once for a while, I want to "gracefully" kill a process spotted by "ps". The
following command lists ttys of every pane, therefore helps to find out in
which pane a process is in
</p>

<div class="org-src-container">

<pre class="src src-shell-script"><span class="org-keyword">function</span> <span class="org-function-name">tt</span> {
    tmux list-panes -a -F <span class="org-string">'#S:#I.#P #{pane_tty}'</span>
}
<span class="org-builtin">export</span> -f tt
</pre>
</div>

<p>
<code>-s [-t session_name]</code> instead of <code>-a</code> for panes in a session only
</p>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Backspace and delete does not work?</h3>
<div class="outline-text-3" id="text-9-3">
<ul class="org-ul">
<li>The root cause

<p>
On receiving an erase char, tmux forward one "^?" char to designated
pane(s).
</p>

<p>
This is usually not an issue since, most of the time, the "^?" is just the
erase char. That is, tmux send out an erase char when get an erase char.
</p>

<p>
But if the erase char was set to "^H", an issue arise:
</p>
<ol class="org-ol">
<li>The tmux get a "^H" and recognize it as an erase char.
</li>
<li>Tmux send out a "^?" for receiving an erase char.
</li>
<li>The shell get a "^?" but NOT interpret it as an erase.
</li>
</ol>
</li>

<li>Solution

<ul class="org-ul">
<li>Put "stty erase ^?" into your profile

<p>
This way, you use "^?" for erase everywhere consistently.
</p>
</li>

<li>Or, at least run "stty erase ^?" before launching tmux

<p>
This way, tmux uses "^?" for erase while the CLI within it still use
"^H".
</p>

<p>
This works since tmux sees "^H" as a normal char and forwards it without
conversion and then the shell regards the "^H" as an erase.
</p>

<p>
This is NOT recommended since it is more popular and default of many
tools to use "^?" for erase.
</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> My configure files</h2>
<div class="outline-text-2" id="text-10">
<p>
Please remember to copy my color theme files as well
</p>

<div class="org-src-container">

<pre class="src src-conf-space"><span class="org-comment-delimiter"># </span><span class="org-comment">Created:  Fang lungang 11/08/2010</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Modified: Fang Lungang 02/05/2015 14:03&gt;</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* Behaviour</span>
<span class="org-variable-name">set-option</span> -g display-time 3000
<span class="org-variable-name">set-option</span> -g history-limit 50000
<span class="org-variable-name">set-option</span> -g repeat-time 1500

<span class="org-comment-delimiter">#</span><span class="org-comment">* Key bindings</span>
<span class="org-variable-name">set-option</span> -g prefix F12        <span class="org-comment-delimiter"># </span><span class="org-comment">if not work, check if TERM=xterm</span>
<span class="org-variable-name">bind-key</span> -n F11 send-prefix     <span class="org-comment-delimiter"># </span><span class="org-comment">F11 becomes 'prefix' of nested tmux sessions</span>
<span class="org-variable-name">bind-key</span> C-b send-prefix        <span class="org-comment-delimiter"># </span><span class="org-comment">F11 C-b ... nested nested ... sessions</span>
<span class="org-variable-name">bind-key</span> | split-window -h      <span class="org-comment-delimiter"># </span><span class="org-comment">default is "</span>
<span class="org-variable-name">bind-key</span> \ split-window -h      <span class="org-comment-delimiter"># </span><span class="org-comment">for those who don't press &lt;shift&gt;</span>
<span class="org-variable-name">bind-key</span> _ split-window -v      <span class="org-comment-delimiter"># </span><span class="org-comment">default is %</span>
<span class="org-variable-name">bind-key</span> - split-window -v      <span class="org-comment-delimiter"># </span><span class="org-comment">for those who don't press &lt;shift&gt;</span>
<span class="org-variable-name">bind-key</span> Tab select-pane -t:.+  <span class="org-comment-delimiter"># </span><span class="org-comment">easier to key-chord than F12+&lt;arrow&gt;</span>
<span class="org-variable-name">bind-key</span> BTab select-pane -t:.-
<span class="org-variable-name">set-option</span> -g status-keys emacs
<span class="org-variable-name">set-option</span> -g mode-keys emacs
<span class="org-variable-name">bind-key</span> C-s set-window-option synchronize-panes
<span class="org-variable-name">bind-key</span> b set-option status
<span class="org-variable-name">bind-key</span> &lt; set-option automatic-rename on

<span class="org-variable-name">bind-key</span> -r n next-window       <span class="org-comment-delimiter"># </span><span class="org-comment">same as default ones but are repeat-able</span>
<span class="org-variable-name">bind-key</span> -r p previous-window
<span class="org-variable-name">bind-key</span> -r Space next-layout

<span class="org-comment-delimiter"># </span><span class="org-comment">Conflicts with my emacs settings.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key -nr C-Up select-pane -U</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key -nr C-Down select-pane -D</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key -nr C-Left select-pane -L</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key -nr C-Right select-pane -R</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* Status bar format</span>
<span class="org-variable-name">set-option</span> -g base-index 1      <span class="org-comment-delimiter"># </span><span class="org-comment">window index starts from 1 instead of 0</span>
<span class="org-variable-name">set-option</span> -g status on
<span class="org-variable-name">set-window-option</span> -g automatic-rename on
<span class="org-variable-name">set-window-option</span> -g monitor-activity on
<span class="org-comment-delimiter"># </span><span class="org-comment">set-option -g status-utf8 on</span>
<span class="org-variable-name">set-option</span> -g status-justify right <span class="org-comment-delimiter"># </span><span class="org-comment">centre</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">set-option -g window-status-format "#I:#W"</span>
<span class="org-variable-name">set-option</span> -g status-left-length 30
<span class="org-variable-name">set-option</span> -g status-left <span class="org-string">"#[fg=green]#S:#T"</span>
<span class="org-variable-name">set-option</span> -g status-right <span class="org-string">"#h %l:%M %p"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* Terminal type</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">NOTE: Comment out this if you don't know what it is</span>
<span class="org-variable-name">set-option</span> -g default-terminal <span class="org-string">"xterm-256color"</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">set-option -g default-terminal "screen-256color"</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">or start tmux with "tmux -2" to force 256</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">"if-shell" runs asynchronously, so it does not help</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* color themes</span>
<span class="org-variable-name">source-file</span> ~/.tmux/lgfang-concise

<span class="org-comment-delimiter">#</span><span class="org-comment">* Terminal emulator window title</span>
<span class="org-variable-name">set</span> -g set-titles on
<span class="org-variable-name">set</span> -g set-titles-string <span class="org-string">'tmux:#S@#h'</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* Mouse support</span>
<span class="org-variable-name">set-option</span> -g mouse-select-pane on
<span class="org-variable-name">set-option</span> -g mouse-resize-pane on
<span class="org-variable-name">set-option</span> -g mouse-select-window on
<span class="org-variable-name">set-window-option</span> -g mode-mouse on


<span class="org-comment-delimiter">#</span><span class="org-comment">* My functions</span>

<span class="org-variable-name">bind-key</span> m command-prompt -p <span class="org-string">"move (swap) current pane with: "</span> <span class="org-string">"swap-pane -s %1"</span>
<span class="org-variable-name">bind-key</span> j command-prompt <span class="org-string">"join-pane -h -d -s '%1'"</span>
<span class="org-variable-name">bind-key</span> C command-prompt <span class="org-string">"new-window '%1'"</span>
<span class="org-variable-name">bind-key</span> S command-prompt <span class="org-string">"new-session -s '%1'"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">** Screen log</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">`C-h' to save log</span>
<span class="org-variable-name">bind-key</span> C-h command-prompt -p <span class="org-string">"save log to:"</span> \
         <span class="org-string">"copy-mode; send-keys 'M-&gt;' C-e C-space 'M-&lt;' C-a C-w; save-buffer %%"</span>
<span class="org-comment-delimiter"># </span><span class="org-comment"># if "set-window-option -g mode-keys vi", use this one:</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key C-h command-prompt -p "save log to:" \</span>
<span class="org-comment-delimiter">#          </span><span class="org-comment">"copy-mode; send-keys g 'space' G 'enter'; save-buffer %%"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">## NOT recommended</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key h pipe-pane "cat &gt;&gt;$HOME/#S-#I-#P.log" \; \</span>
<span class="org-comment-delimiter">#          </span><span class="org-comment">rename-window "log" \; \</span>
<span class="org-comment-delimiter">#          </span><span class="org-comment">display-message "Start logging($HOME/#S-#I-#P.log)"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">bind-key H pipe-pane \; \</span>
<span class="org-comment-delimiter">#          </span><span class="org-comment">set-window-option automatic-rename on \; \</span>
<span class="org-comment-delimiter">#          </span><span class="org-comment">display-message "Stopped logging(#S-#I-#P.log)"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">* Usage of Screen in case tmux is not available</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">***********************************************</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">screen -S foo # new session foo</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">screen -x foo # attach to session foo</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">screen -ls    # list all sessions</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">C-a C-c       # create a new window</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">C-a "         # list and switch window</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">C-a C-d       # detach</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">C-a k         # kill window</span>
</pre>
</div>
</div>

<div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Color themes</h3>
<div class="outline-text-3" id="text-10-1">
<p>
I put color related stuffs into dedicated files so that I can
<code>source-file path/to/scheme</code> to change the look of tmux dynamically.
</p>
</div>

<div id="outline-container-sec-10-1-1" class="outline-4">
<h4 id="sec-10-1-1"><span class="section-number-4">10.1.1</span> block</h4>
<div class="outline-text-4" id="text-10-1-1">
<div class="org-src-container">

<pre class="src src-conf"><span class="org-comment-delimiter"># </span><span class="org-comment">\file Name: lgfang-blocks -*-mode:conf-*-</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Based on https://github.com/seebi/tmux-colors-solarized</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Modified: Fang Lungang 04/03/2014 12:16&gt;</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">default statusbar colors</span>
set-option -g status-fg colour235
set-option -g status-bg colour244
set-option -g status-attr default

<span class="org-comment-delimiter"># </span><span class="org-comment">default window title colors</span>
set-window-option -g window-status-fg default
set-window-option -g window-status-bg colour64
<span class="org-comment-delimiter">#</span><span class="org-comment">set-window-option -g window-status-attr dim</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">current window title colors</span>
set-window-option -g window-status-current-bg colour166
set-window-option -g window-status-current-fg default
<span class="org-comment-delimiter">#</span><span class="org-comment">set-window-option -g window-status-current-attr bright</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">activity indication</span>
set-window-option -g window-status-activity-bg red
set-window-option -g window-status-activity-fg default
set-window-option -g window-status-activity-attr none

<span class="org-comment-delimiter"># </span><span class="org-comment">pane border</span>
set-option -g pane-border-fg colour235
set-option -g pane-active-border-fg colour240

<span class="org-comment-delimiter"># </span><span class="org-comment">message text</span>
set-option -g message-bg colour235
set-option -g message-fg colour166

<span class="org-comment-delimiter"># </span><span class="org-comment">pane number display</span>
set-option -g display-panes-active-colour colour166
set-option -g display-panes-colour colour33

<span class="org-comment-delimiter"># </span><span class="org-comment">clock</span>
set-window-option -g clock-mode-colour colour64
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-1-2" class="outline-4">
<h4 id="sec-10-1-2"><span class="section-number-4">10.1.2</span> concise</h4>
<div class="outline-text-4" id="text-10-1-2">
<div class="org-src-container">

<pre class="src src-conf"><span class="org-comment-delimiter"># </span><span class="org-comment">\file Name: lgfang-concise -*-mode:conf-*-</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Based on https://github.com/seebi/tmux-colors-solarized</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Modified: Fang lungang 12/08/2013 21:25&gt;</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">default statusbar colors</span>
set-option -g status-fg colour244 <span class="org-comment-delimiter">#</span><span class="org-comment">base0</span>
set-option -g status-bg colour235 <span class="org-comment-delimiter">#</span><span class="org-comment">base02</span>
set-option -g status-attr default

<span class="org-comment-delimiter"># </span><span class="org-comment">default window title colors</span>
set-window-option -g window-status-fg colour64 <span class="org-comment-delimiter">#</span><span class="org-comment">green</span>
set-window-option -g window-status-bg default
<span class="org-comment-delimiter">#</span><span class="org-comment">set-window-option -g window-status-attr dim</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">current window title colors</span>
set-window-option -g window-status-current-fg colour166 <span class="org-comment-delimiter">#</span><span class="org-comment">orange</span>
set-window-option -g window-status-current-bg default
<span class="org-comment-delimiter">#</span><span class="org-comment">set-window-option -g window-status-current-attr bright</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">activity indication</span>
set-window-option -g window-status-activity-fg red
set-window-option -g window-status-activity-attr none

<span class="org-comment-delimiter"># </span><span class="org-comment">pane border</span>
set-option -g pane-border-fg colour235 <span class="org-comment-delimiter">#</span><span class="org-comment">base02</span>
set-option -g pane-active-border-fg colour240 <span class="org-comment-delimiter">#</span><span class="org-comment">base01</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">message text</span>
set-option -g message-bg colour235 <span class="org-comment-delimiter">#</span><span class="org-comment">base02</span>
set-option -g message-fg colour166 <span class="org-comment-delimiter">#</span><span class="org-comment">orange</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">pane number display</span>
set-option -g display-panes-active-colour colour166 <span class="org-comment-delimiter">#</span><span class="org-comment">orange</span>
set-option -g display-panes-colour colour33 <span class="org-comment-delimiter">#</span><span class="org-comment">blue</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">clock</span>
set-window-option -g clock-mode-colour colour64 <span class="org-comment-delimiter">#</span><span class="org-comment">green</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> An example of scripting tmux</h2>
<div class="outline-text-2" id="text-11">
<div class="org-src-container">

<pre class="src src-shell-script"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Created:  Fang lungang 2011</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Modified: Fang Lungang 10/04/2014 15:07&gt;</span>

<span class="org-builtin">set</span> -o nounset
<span class="org-builtin">set</span> -o errexit
<span class="org-builtin">set</span> -o pipefail
<span class="org-comment-delimiter"># </span><span class="org-comment">set -x</span>

<span class="org-variable-name">REMOTE_HOST</span>=<span class="org-string">"135.1.2.3"</span>
<span class="org-variable-name">REMOTE_LOGIN</span>=<span class="org-string">"lgfang"</span>
<span class="org-variable-name">MY_PATH</span>=<span class="org-string">".local/bin/tmux-dwim"</span> <span class="org-comment-delimiter"># </span><span class="org-comment">path to this script on the remote host</span>
<span class="org-variable-name">REMOTE_CMD</span>=<span class="org-string">"source .bash_profile; $MY_PATH"</span>
<span class="org-variable-name">SESSION_NAME</span>=<span class="org-string">"hi"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Attach if the session already exists</span>
<span class="org-keyword">if</span> tmux has-session -t $<span class="org-variable-name">SESSION_NAME</span> 2&gt;/dev/null; <span class="org-keyword">then</span>
    <span class="org-keyword">exec</span> tmux attach -t $<span class="org-variable-name">SESSION_NAME</span>
<span class="org-keyword">fi</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Start a session</span>
tmux new-session -d -s $<span class="org-variable-name">SESSION_NAME</span>

<span class="org-keyword">if</span> hostname | grep -q <span class="org-string">"\(lgfang\|lungang\|PA0019712\)"</span>; <span class="org-keyword">then</span>
    <span class="org-variable-name">this_is_mypc</span>=true
<span class="org-keyword">else</span>
    <span class="org-variable-name">this_is_mypc</span>=false
<span class="org-keyword">fi</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">linux ping and windows ping use different options for the same meaning</span>
<span class="org-keyword">if</span> which ping | grep -q -i windows; <span class="org-keyword">then</span>
    <span class="org-variable-name">PING</span>=<span class="org-string">"ping -n 1 -w 1"</span>
<span class="org-keyword">else</span>
    <span class="org-variable-name">PING</span>=<span class="org-string">"ping -c 1 -W 1"</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> <span class="org-negation-char">!</span> $<span class="org-variable-name">this_is_mypc</span>; <span class="org-keyword">then</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">I am already on the "remote_host"</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">Start Emacs in a window with specified number</span>
    tmux new-window -d -n emacsclient -t $<span class="org-variable-name">SESSION_NAME</span>:9 <span class="org-sh-escaped-newline">\</span>
        <span class="org-string">"emacsclient -t || (emacs --daemon &amp;&amp; emacsclient -t)"</span>

<span class="org-keyword">elif</span> $<span class="org-variable-name">PING</span> $<span class="org-variable-name">REMOTE_HOST</span>; <span class="org-keyword">then</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">I am on the local PC and remote host ping-able.</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">Run this script on the remote host to create a similar session</span>
    tmux new-window -d -n $<span class="org-variable-name">REMOTE_HOST</span> -t $<span class="org-variable-name">SESSION_NAME</span>:9 <span class="org-sh-escaped-newline">\</span>
        <span class="org-string">"ssh -o BatchMode=yes -t $REMOTE_LOGIN@$REMOTE_HOST '$REMOTE_CMD'"</span>

    tmux select-window -t $<span class="org-variable-name">SESSION_NAME</span>:9
    <span class="org-comment-delimiter"># </span><span class="org-comment">make it feels like I'm working on the remote host locally</span>
    tmux set-option -g -t $<span class="org-variable-name">SESSION_NAME</span> status off
    tmux set-option -g -t $<span class="org-variable-name">SESSION_NAME</span> prefix F11
<span class="org-keyword">fi</span>

<span class="org-keyword">exec</span> tmux attach -t $<span class="org-variable-name">SESSION_NAME</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'lgfang'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

     <p>
     <span class="date">Created: 2015-03-05 Thu 14:22</span>
     by <span class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</span>
     </p>
</div>
</div></body>
</html>
